(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[439],{4841:function(e,t,a){Promise.resolve().then(a.bind(a,8548))},8548:function(e,t,a){"use strict";a.r(t),a.d(t,{default:function(){return l}});var n=a(7437),r=a(2265),s=a(5475),i=a(6986);function c(){var e,t,a;let c=(0,s.useSearchParams)(),[l,o]=(0,r.useState)(null),[d,u]=(0,r.useState)(null),[m,h]=(0,r.useState)(!1),[x,f]=(0,r.useState)(null);(0,r.useEffect)(()=>{let e=c.get("id");if(!e){f("Missing verification ID");return}try{let t=localStorage.getItem("verification_".concat(e));t?o(JSON.parse(t)):f("Verification data not found")}catch(e){f("Failed to load verification data")}},[c]);let p=async()=>{if(!(null==l?void 0:l.enclave_url)){f("Enclave URL not available");return}h(!0);try{let e=await (0,i.Hd)(l.enclave_url);u(e)}catch(e){console.error("Attestation error:",e),f("Failed to fetch attestation")}finally{h(!1)}};return x?(0,n.jsx)("div",{className:"min-h-screen bg-[#0a0a0a] p-8",children:(0,n.jsx)("div",{className:"max-w-4xl mx-auto",children:(0,n.jsx)("div",{className:"p-4 bg-red-900/50 border border-red-800 rounded-lg text-red-400",children:x})})}):l?(0,n.jsx)("div",{className:"min-h-screen bg-[#0a0a0a] p-8",children:(0,n.jsxs)("div",{className:"max-w-4xl mx-auto",children:[(0,n.jsx)("h1",{className:"text-2xl font-bold text-white mb-6",children:"Message Verification"}),(0,n.jsxs)("div",{className:"space-y-6",children:[(0,n.jsxs)("div",{className:"bg-[#1a1a1a] rounded-lg border border-gray-800 p-4",children:[(0,n.jsx)("h2",{className:"text-lg font-medium text-gray-300 mb-2",children:"Request"}),(0,n.jsx)("pre",{className:"text-white whitespace-pre-wrap break-words",children:l.message})]}),(0,n.jsxs)("div",{className:"bg-[#1a1a1a] rounded-lg border border-gray-800 p-4",children:[(0,n.jsx)("h2",{className:"text-lg font-medium text-gray-300 mb-2",children:"Response"}),(0,n.jsx)("pre",{className:"text-white whitespace-pre-wrap break-words",children:l.response})]}),(0,n.jsxs)("div",{className:"bg-[#1a1a1a] rounded-lg border border-gray-800 p-4",children:[(0,n.jsx)("h2",{className:"text-lg font-medium text-gray-300 mb-2",children:"Metadata"}),(0,n.jsxs)("div",{className:"space-y-2 text-sm",children:[(0,n.jsxs)("div",{children:[(0,n.jsx)("span",{className:"text-gray-400",children:"Platform:"})," ",(0,n.jsx)("span",{className:"text-white",children:l.platform||"Unknown"})]}),(0,n.jsxs)("div",{children:[(0,n.jsx)("span",{className:"text-gray-400",children:"Model:"})," ",(0,n.jsx)("span",{className:"text-white",children:l.ai_model||"Unknown"})]}),(0,n.jsxs)("div",{children:[(0,n.jsx)("span",{className:"text-gray-400",children:"Timestamp:"})," ",(0,n.jsx)("span",{className:"text-white",children:(a=l.timestamp)?new Date(1e3*a).toLocaleString():"Unknown"})]})]})]}),(0,n.jsxs)("div",{className:"bg-[#1a1a1a] rounded-lg border border-gray-800 p-4",children:[(0,n.jsx)("h2",{className:"text-lg font-medium text-gray-300 mb-2",children:"Signature"}),(0,n.jsx)("div",{className:"p-3 bg-primary/10 rounded text-primary font-mono text-sm break-all",children:l.signature})]}),(0,n.jsxs)("div",{className:"bg-[#1a1a1a] rounded-lg border border-gray-800 p-4",children:[(0,n.jsxs)("div",{className:"flex items-center justify-between mb-4",children:[(0,n.jsx)("h2",{className:"text-lg font-medium text-gray-300",children:"Attestation"}),(0,n.jsx)("button",{onClick:p,disabled:m,className:"px-4 py-2 bg-gray-800 text-white rounded-lg hover:bg-gray-700 disabled:opacity-50",children:m?"Loading...":d?"Refresh":"Get Attestation"})]}),d&&(0,n.jsxs)("div",{className:"space-y-3 text-xs",children:[(0,n.jsxs)("div",{children:[(0,n.jsx)("span",{className:"text-gray-400",children:"Module ID:"})," ",(0,n.jsx)("code",{className:"text-white break-all",children:d.attestation_document.module_id})]}),(0,n.jsxs)("div",{children:[(0,n.jsx)("span",{className:"text-gray-400",children:"Digest:"})," ",(0,n.jsx)("code",{className:"text-white",children:d.attestation_document.digest})]}),(0,n.jsxs)("div",{children:[(0,n.jsx)("span",{className:"text-gray-400",children:"Timestamp:"})," ",(0,n.jsx)("span",{className:"text-white",children:new Date(d.attestation_document.timestamp).toLocaleString()})]}),(0,n.jsxs)("div",{children:[(0,n.jsx)("span",{className:"text-gray-400",children:"PCRs:"}),(0,n.jsx)("div",{className:"mt-1 space-y-1",children:Object.entries(d.attestation_document.pcrs).map(e=>{let[t,a]=e;return(0,n.jsxs)("div",{className:"text-white",children:[(0,n.jsxs)("span",{className:"text-gray-500",children:["PCR ",t,":"]})," ",(0,n.jsx)("code",{className:"break-all",children:String(a)})]},t)})})]}),(0,n.jsxs)("div",{children:[(0,n.jsx)("span",{className:"text-gray-400",children:"Public Key (hex):"}),(0,n.jsx)("pre",{className:"mt-1 p-2 bg-[#0a0a0a] rounded text-white break-all",children:d.attestation_document.public_key})]}),(0,n.jsxs)("div",{children:[(0,n.jsx)("span",{className:"text-gray-400",children:"User Data:"}),(0,n.jsx)("div",{className:"mt-1 p-2 bg-[#0a0a0a] rounded text-white overflow-auto max-h-40",children:"object"==typeof d.attestation_document.user_data?(0,n.jsx)("pre",{children:JSON.stringify(d.attestation_document.user_data,null,2)}):(0,n.jsx)("code",{className:"break-all",children:d.attestation_document.user_data})})]}),d.signature&&(0,n.jsxs)("div",{children:[(0,n.jsx)("span",{className:"text-gray-400",children:"Attestation Signature:"}),(0,n.jsx)("div",{className:"mt-1 p-2 bg-[#0a0a0a] rounded text-white break-all font-mono",children:d.signature})]}),d.attestation_document.certificate&&(0,n.jsxs)("div",{children:[(0,n.jsx)("span",{className:"text-gray-400",children:"Enclave Certificate (PEM):"}),(0,n.jsx)("pre",{className:"mt-1 p-2 bg-[#0a0a0a] rounded text-white overflow-auto max-h-32 font-mono scrollbar-hide",children:d.attestation_document.certificate})]}),d.attestation_document.cabundle&&d.attestation_document.cabundle.length>0&&(0,n.jsxs)("div",{children:[(0,n.jsxs)("span",{className:"text-gray-400",children:["CA Bundle (",d.attestation_document.cabundle.length," certs):"]}),(0,n.jsx)("div",{className:"mt-1 space-y-2",children:d.attestation_document.cabundle.map((e,t)=>(0,n.jsx)("pre",{className:"p-2 bg-[#0a0a0a] rounded text-white overflow-auto max-h-32 font-mono scrollbar-hide",children:e},t))})]}),(0,n.jsxs)("div",{className:"flex gap-4 mt-2",children:[(0,n.jsxs)("div",{className:"flex items-center gap-1",children:[(0,n.jsx)("span",{className:"w-2 h-2 rounded-full ".concat(d.attestation_document.certificate?"bg-green-500":"bg-red-500")}),(0,n.jsxs)("span",{className:"text-gray-400",children:["Certificate: ",d.attestation_document.certificate?"Present":"Missing"]})]}),(0,n.jsxs)("div",{className:"flex items-center gap-1",children:[(0,n.jsx)("span",{className:"w-2 h-2 rounded-full ".concat((null===(e=d.attestation_document.cabundle)||void 0===e?void 0:e.length)>0?"bg-green-500":"bg-red-500")}),(0,n.jsxs)("span",{className:"text-gray-400",children:["CA Bundle: ",(null===(t=d.attestation_document.cabundle)||void 0===t?void 0:t.length)>0?"Present":"Missing"]})]})]})]})]})]})]})}):(0,n.jsx)("div",{className:"min-h-screen bg-[#0a0a0a] p-8",children:(0,n.jsx)("div",{className:"max-w-4xl mx-auto text-gray-400",children:"Loading verification data..."})})}function l(){return(0,n.jsx)(r.Suspense,{fallback:(0,n.jsx)("div",{className:"min-h-screen bg-[#0a0a0a] p-8 text-gray-400",children:"Loading..."}),children:(0,n.jsx)(c,{})})}},6986:function(e,t,a){"use strict";function n(e){if(!e)return{isJson:!1};try{let t="string"==typeof e?JSON.parse(e):e;return{ethAddr:t.eth_addr||t.ethAddr,isJson:!0,jsonData:t}}catch(t){if("string"==typeof e&&e.startsWith("0x"))return{ethAddr:e,isJson:!1};return{isJson:!1}}}a.d(t,{Hd:function(){return u},nr:function(){return s},tG:function(){return n},u4:function(){return d}});let r=e=>Array.from(e instanceof Uint8Array?e:new Uint8Array(e)).map(e=>e.toString(16).padStart(2,"0")).join(""),s=e=>{e.startsWith("0x")&&(e=e.slice(2));let t=new Uint8Array(e.length/2);for(let a=0;a<e.length;a+=2)t[a/2]=parseInt(e.substr(a,2),16);return t};function i(e,t){var a;let n=(null===(a=btoa(new Uint8Array(t).reduce((e,t)=>e+String.fromCharCode(t),"")).match(/.{1,64}/g))||void 0===a?void 0:a.join("\n"))||"";return"-----BEGIN ".concat(e,"-----\n").concat(n,"\n-----END ").concat(e,"-----")}function c(e){for(let t=0;t<e.length;t++){let a=e.charCodeAt(t);if(!(a>=32&&a<=126||13===a||10===a||9===a))return!1}return!0}function l(e){if(e instanceof Uint8Array||e instanceof ArrayBuffer){let t=e instanceof Uint8Array?e:new Uint8Array(e);try{let e=new TextDecoder().decode(t);if(c(e))return e}catch(e){}return btoa(t.reduce((e,t)=>e+String.fromCharCode(t),""))}if(e instanceof Map){let t={};for(let[a,n]of Array.from(e.entries()))t[String(a)]=l(n);return t}if(Array.isArray(e))return e.map(e=>l(e));if(null!==e&&"object"==typeof e){let t={};for(let[a,n]of Object.entries(e))t[a]=l(n);return t}return e}function o(e){var t,a;console.log("[DEBUG] Raw attestation document:",e),console.log("[DEBUG] doc.public_key:",e.public_key),console.log("[DEBUG] doc.public_key type:",null===(a=e.public_key)||void 0===a?void 0:null===(t=a.constructor)||void 0===t?void 0:t.name);let n=e.public_key;e instanceof Map&&console.log("[DEBUG] doc is Map, public_key from get():",n=e.get("public_key"));let s=l(e),o=e instanceof Map?e.get("pcrs"):e.pcrs;if(o){let e={};if(o instanceof Map)for(let[t,a]of Array.from(o.entries()))e[String(t)]=a instanceof Uint8Array?r(a):l(a);else for(let[t,a]of Object.entries(o))e[t]=a instanceof Uint8Array?r(a):l(a);s.pcrs=e}if(n instanceof Uint8Array){let e=function(e){let t=new Uint8Array([48,118,48,16,6,7,42,134,72,206,61,2,1,6,5,43,129,4,0,34,3,98,0]);if(120===e.length&&48===e[0])return e;if(97!==e.length)return console.warn("[rawToDer] Unexpected key length ".concat(e.length,", returning as-is")),e;let a=new Uint8Array(t.length+e.length);return a.set(t,0),a.set(e,t.length),a}(n);s.public_key=r(e),console.log("[DEBUG] Converted public_key to DER hex:",s.public_key)}else n&&console.log("[DEBUG] publicKeyRaw is NOT Uint8Array, it is:",typeof n,n);let d=e instanceof Map?e.get("certificate"):e.certificate;d instanceof Uint8Array&&(s.certificate=i("CERTIFICATE",d));let u=e instanceof Map?e.get("cabundle"):e.cabundle;Array.isArray(u)&&(s.cabundle=u.map(e=>e instanceof Uint8Array?i("CERTIFICATE",e):l(e)));let m=e instanceof Map?e.get("user_data"):e.user_data;if(m instanceof Uint8Array)try{let e=new TextDecoder().decode(m);if(c(e))try{s.user_data=JSON.parse(e)}catch(t){s.user_data=e}else s.user_data=r(m)}catch(e){s.user_data=r(m)}return s}async function d(e){let t=await a.e(693).then(a.t.bind(a,4693,23)),n=atob(e),s=new Uint8Array(n.length);for(let e=0;e<n.length;e++)s[e]=n.charCodeAt(e);try{let e=t.decode(s);if(Array.isArray(e)&&e.length>=3){let a=e[0],n=a;if(a instanceof Uint8Array)try{n=t.decode(a)}catch(e){}let s=e[1],i=e[2],c=e.length>3?e[3]:null,d=t.decode(i),u=o(d);return{protected_header:l(n),unprotected_header:l(s),attestation_document:u,signature:c instanceof Uint8Array?r(c):l(c),module_id:u.module_id,digest:u.digest,timestamp:u.timestamp,pcrs:u.pcrs,public_key:u.public_key,user_data:"object"==typeof u.user_data?JSON.stringify(u.user_data):u.user_data,certificate:u.certificate,cabundle:u.cabundle,nonce:u.nonce}}{let t=o(e);return{attestation_document:t,module_id:t.module_id,digest:t.digest,timestamp:t.timestamp,pcrs:t.pcrs,public_key:t.public_key,user_data:"object"==typeof t.user_data?JSON.stringify(t.user_data):t.user_data,certificate:t.certificate,cabundle:t.cabundle,nonce:t.nonce}}}catch(e){throw console.error("Failed to parse CBOR attestation:",e),Error("Failed to parse attestation data")}}async function u(e,t){let a="".concat(e.replace(/\/$/,""),"/.well-known/attestation"),n={};t&&(n.nonce=btoa(t));let r=await fetch(a,{method:"POST",headers:{"Content-Type":"application/json",Accept:"application/cbor, application/octet-stream, application/json"},body:JSON.stringify(n)});if(!r.ok)throw Error("Failed to fetch attestation: ".concat(r.status));let s=r.headers.get("content-type")||"";if(s.includes("application/cbor")||s.includes("application/octet-stream")){let e=btoa(new Uint8Array(await r.arrayBuffer()).reduce((e,t)=>e+String.fromCharCode(t),""));return{...await d(e),raw_doc:e}}{let e=await r.json();if(e.attestation_document)return{...e,raw_doc:e.attestation_doc||JSON.stringify(e)};if(e.attestation_doc)return{...await d(e.attestation_doc),raw_doc:e.attestation_doc};throw Error("Unexpected attestation response format")}}}},function(e){e.O(0,[971,117,744],function(){return e(e.s=4841)}),_N_E=e.O()}]);