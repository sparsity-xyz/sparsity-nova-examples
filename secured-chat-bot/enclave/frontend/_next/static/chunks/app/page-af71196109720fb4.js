(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[931],{6710:function(e,t,a){Promise.resolve().then(a.bind(a,438))},438:function(e,t,a){"use strict";a.r(t),a.d(t,{default:function(){return f}});var s=a(7437),r=a(2265),n=a(3815),i=a(6986);function l(e){return Array.from(e instanceof Uint8Array?e:new Uint8Array(e)).map(e=>e.toString(16).padStart(2,"0")).join("")}function c(e,t){if("P-384"===t){if(120===e.length)return e.slice(23);if(97===e.length)return e}if("secp256k1"===t){if(88===e.length)return e.slice(23);if(65===e.length)return e}return console.warn("[derToRaw] Unexpected key length ".concat(e.length," for curve ").concat(t)),e}function o(e,t){if("P-384"===t){let t=(0,i.nr)("3076301006072a8648ce3d020106082b81040022036200"),a=new Uint8Array(t.length+e.length);return a.set(t,0),a.set(e,t.length),a}{let t=(0,i.nr)("3056301006072a8648ce3d020106052b8104000a034200"),a=new Uint8Array(t.length+e.length);return a.set(t,0),a.set(e,t.length),a}}class d{get baseUrl(){return this.enclaveBaseUrl}async connect(e){this.enclaveBaseUrl=e.replace(/\/$/,"");let t=await this.fetchAttestation();if(this.curve=function(e){if(e.includes("2b81040022"))return"P-384";if(e.includes("2b8104000a"))return"secp256k1";let t=e.length;return 240===t||194===t?"P-384":176===t||130===t?"secp256k1":t>160?"P-384":"secp256k1"}(t.public_key),console.log("Detected enclave curve: ".concat(this.curve)),"P-384"===this.curve){this.p384KeyPair=await crypto.subtle.generateKey({name:"ECDH",namedCurve:"P-384"},!0,["deriveBits"]);let e=c((0,i.nr)(t.public_key),"P-384");this.serverP384Key=await crypto.subtle.importKey("raw",e,{name:"ECDH",namedCurve:"P-384"},!0,[])}else{this.secpPrivKey=n.P6.randomSecretKey(),this.secpPubKey=n.$3(this.secpPrivKey,!1);let e=(0,i.nr)(t.public_key);this.serverSecpPubKeyRaw=c(e,"secp256k1");try{let e=Array.from(this.serverSecpPubKeyRaw).map(e=>e.toString(16).padStart(2,"0")).join("");n.E9.fromHex(e)}catch(e){throw console.error("Invalid server public key:",t.public_key),Error("Failed to validate server public key: ".concat(e instanceof Error?e.message:String(e)))}}return this.isConnected=!0,t}async fetchAttestation(){try{let e=await (0,i.Hd)(this.enclaveBaseUrl),t=e.attestation_document.public_key||"";return{attestation_doc:e.raw_doc,public_key:t,parsedAttestation:JSON.stringify(e)}}catch(e){throw console.error("Failed to fetch attestation:",e),e}}async deriveSharedKey(e){let t;let a=c((0,i.nr)(e),this.curve);if("P-384"===this.curve){if(!this.p384KeyPair)throw Error("P-384 keys not initialized");let e=await crypto.subtle.importKey("raw",a,{name:"ECDH",namedCurve:"P-384"},!0,[]);t=await crypto.subtle.deriveBits({name:"ECDH",public:e},this.p384KeyPair.privateKey,384)}else{if(!this.secpPrivKey)throw Error("secp256k1 keys not initialized");t=n.ZV(this.secpPrivKey,a).slice(1,33).buffer}let s=await crypto.subtle.importKey("raw",t,{name:"HKDF"},!1,["deriveKey"]);return crypto.subtle.deriveKey({name:"HKDF",hash:"SHA-256",salt:new Uint8Array(0),info:new TextEncoder().encode("encryption data")},s,{name:"AES-GCM",length:256},!1,["encrypt","decrypt"])}async encrypt(e){let t;if(!this.isConnected)throw Error("Not connected");let a=await this.fetchAttestation(),s=await this.deriveSharedKey(a.public_key),r=crypto.getRandomValues(new Uint8Array(32)),n=await crypto.subtle.encrypt({name:"AES-GCM",iv:r.slice(0,12)},s,new TextEncoder().encode(e));return t="P-384"===this.curve?o(new Uint8Array(await crypto.subtle.exportKey("raw",this.p384KeyPair.publicKey)),"P-384"):o(this.secpPubKey,"secp256k1"),{nonce:l(r),public_key:l(t),data:l(n)}}async decrypt(e){if(!this.isConnected)throw Error("Not connected");let t=await this.deriveSharedKey(e.public_key),a=(0,i.nr)(e.nonce).slice(0,12),s=await crypto.subtle.decrypt({name:"AES-GCM",iv:a},t,(0,i.nr)(e.encrypted_data));return new TextDecoder().decode(s)}async setApiKey(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"openai",a=JSON.stringify({api_key:e,platform:t}),s=await this.encrypt(a),r=await fetch("".concat(this.enclaveBaseUrl,"/set-api-key"),{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(s)});if(!r.ok)throw Error("Failed to set API key");let n=await r.json();return JSON.parse(await this.decrypt(n.data))}async chat(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"gpt-4",a=JSON.stringify({message:e,ai_model:t}),s=await this.encrypt(a),r=await fetch("".concat(this.enclaveBaseUrl,"/talk"),{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(s)});if(!r.ok)throw Error("Chat failed");let n=await r.json(),i=await this.decrypt(n.data),l=JSON.parse(i),c=await this.fetchAttestation(),o=await this.checkHealth();return{...l,signature:n.sig,verificationData:{attestation:c.attestation_doc,publicKey:c.public_key,ethAddr:o.enclave_address,encryptedRequest:JSON.stringify(s),decryptedRequest:a,rawResponse:JSON.stringify(n),encryptedResponse:JSON.stringify(n.data),decryptedResponse:i}}}async checkHealth(){return(await fetch("".concat(this.enclaveBaseUrl,"/"))).json()}constructor(){this.enclaveBaseUrl="",this.isConnected=!1,this.curve="P-384",this.p384KeyPair=null,this.serverP384Key=null,this.secpPrivKey=null,this.secpPubKey=null,this.serverSecpPubKeyRaw=null}}let m=new d;function u(e){let{onConnected:t}=e,[a,n]=(0,r.useState)("https://98.app.sparsity.cloud"),[i,l]=(0,r.useState)(!1),[c,o]=(0,r.useState)(null),[d,u]=(0,r.useState)(null),x=async()=>{if(!a.trim()){o("Please enter the enclave base URL");return}l(!0),o(null);try{await m.connect(a.trim());let e=await m.checkHealth();u(e.enclave_address),t(e.enclave_address)}catch(e){console.error("Connection error:",e),o(e instanceof Error?e.message:"Failed to connect to enclave")}finally{l(!1)}};return(0,s.jsxs)("div",{className:"bg-[#1a1a1a] rounded-lg border border-gray-800 p-6",children:[(0,s.jsx)("h2",{className:"text-xl font-semibold text-white mb-4",children:"Connect to Enclave"}),d?(0,s.jsxs)("div",{className:"space-y-3",children:[(0,s.jsxs)("div",{className:"flex items-center gap-2",children:[(0,s.jsx)("div",{className:"w-3 h-3 rounded-full bg-green-500"}),(0,s.jsx)("span",{className:"text-green-400 font-medium",children:"Connected"})]}),(0,s.jsxs)("div",{children:[(0,s.jsx)("span",{className:"text-sm text-gray-400",children:"Base URL:"}),(0,s.jsx)("p",{className:"text-white font-mono text-sm break-all",children:m.baseUrl})]}),(0,s.jsxs)("div",{children:[(0,s.jsx)("span",{className:"text-sm text-gray-400",children:"Enclave Address:"}),(0,s.jsx)("p",{className:"text-primary font-mono text-sm break-all",children:d})]})]}):(0,s.jsxs)("div",{className:"space-y-4",children:[(0,s.jsxs)("div",{children:[(0,s.jsx)("label",{htmlFor:"baseUrl",className:"block text-sm font-medium text-gray-300 mb-2",children:"Enclave Base URL"}),(0,s.jsx)("input",{id:"baseUrl",type:"text",value:a,onChange:e=>n(e.target.value),placeholder:"https://your-enclave.nova.sparsity.io",className:"w-full px-4 py-3 bg-[#0a0a0a] border border-gray-700 rounded-lg text-white placeholder-gray-500 focus:outline-none focus:ring-2 focus:ring-primary",disabled:i}),(0,s.jsx)("p",{className:"mt-2 text-xs text-gray-500",children:"The enclave provides attestation at /.well-known/attestation"})]}),c&&(0,s.jsx)("div",{className:"p-3 bg-red-900/50 border border-red-800 rounded-lg text-red-400 text-sm",children:c}),(0,s.jsx)("button",{onClick:x,disabled:i,className:"w-full py-3 px-4 bg-primary text-black font-medium rounded-lg hover:bg-primary/90 disabled:bg-primary/50 disabled:cursor-not-allowed transition-colors",children:i?(0,s.jsxs)("span",{className:"flex items-center justify-center gap-2",children:[(0,s.jsx)("span",{className:"w-2 h-2 rounded-full bg-black animate-bounce",style:{animationDelay:"0ms"}}),(0,s.jsx)("span",{className:"w-2 h-2 rounded-full bg-black animate-bounce",style:{animationDelay:"150ms"}}),(0,s.jsx)("span",{className:"w-2 h-2 rounded-full bg-black animate-bounce",style:{animationDelay:"300ms"}})]}):"Connect"})]})]})}function x(e){let{isConnected:t,onApiKeySet:a}=e,[n,i]=(0,r.useState)(""),[l,c]=(0,r.useState)("openai"),[o,d]=(0,r.useState)(!1),[u,x]=(0,r.useState)(!1),[p,h]=(0,r.useState)(null),[y,f]=(0,r.useState)(!1),[g,b]=(0,r.useState)(!1),[v,j]=(0,r.useState)(null),[w,N]=(0,r.useState)(null),k=(0,r.useCallback)(async()=>{if(t){b(!0),h(null);try{let e=await m.checkHealth();console.log("Health check result:",e),e.api_key_available&&(f(!0),N(e.cached_platform||"openai"),j(3))}catch(e){console.error("Error checking health:",e)}finally{b(!1)}}},[t]);(0,r.useEffect)(()=>{t&&k()},[t,k]),(0,r.useEffect)(()=>{if(null===v)return;if(v<=0){a();return}let e=setTimeout(()=>{j(v-1)},1e3);return()=>clearTimeout(e)},[v,a]);let A=async()=>{if(!n.trim()){h("Please enter an API key");return}if(!t){h("Please connect to enclave first");return}x(!0),h(null);try{let e=await m.setApiKey(n.trim(),l);console.log("API key set result:",e),f(!0),N(l),i(""),a()}catch(e){console.error("Error setting API key:",e),h(e instanceof Error?e.message:"Failed to set API key")}finally{x(!1)}};return(0,s.jsxs)("div",{className:"bg-[#1a1a1a] rounded-lg border border-gray-800 p-6",children:[(0,s.jsx)("h2",{className:"text-xl font-semibold text-white mb-4",children:"Set API Key"}),t?g?(0,s.jsxs)("div",{className:"flex items-center gap-3",children:[(0,s.jsx)("div",{className:"w-5 h-5 border-2 border-primary border-t-transparent rounded-full animate-spin"}),(0,s.jsx)("span",{className:"text-gray-400",children:"Checking API key status..."})]}):y?(0,s.jsxs)("div",{className:"space-y-3",children:[(0,s.jsxs)("div",{className:"flex items-center gap-2",children:[(0,s.jsx)("div",{className:"w-3 h-3 rounded-full bg-green-500"}),(0,s.jsx)("span",{className:"text-green-400 font-medium",children:"API Key Already Configured"})]}),w&&(0,s.jsxs)("p",{className:"text-sm text-gray-400",children:["Platform: ",(0,s.jsx)("span",{className:"text-white",children:"openai"===w?"OpenAI":w})]}),null!==v&&v>0&&(0,s.jsxs)("p",{className:"text-sm text-gray-400",children:["Proceeding to chat in ",(0,s.jsx)("span",{className:"text-primary font-medium",children:v})," seconds..."]}),(0,s.jsx)("button",{onClick:()=>{f(!1),j(null)},className:"text-sm text-primary hover:underline",children:"Update API Key"})]}):(0,s.jsxs)("div",{className:"space-y-4",children:[(0,s.jsxs)("div",{children:[(0,s.jsx)("label",{htmlFor:"apiKey",className:"block text-sm font-medium text-gray-300 mb-2",children:"API Key"}),(0,s.jsxs)("div",{className:"relative",children:[(0,s.jsx)("input",{id:"apiKey",type:o?"text":"password",value:n,onChange:e=>i(e.target.value),placeholder:"sk-...",className:"w-full px-4 py-3 pr-12 bg-[#0a0a0a] border border-gray-700 rounded-lg text-white placeholder-gray-500 focus:outline-none focus:ring-2 focus:ring-primary",disabled:u}),(0,s.jsx)("button",{type:"button",onClick:()=>d(!o),className:"absolute right-3 top-1/2 -translate-y-1/2 text-gray-400 hover:text-white",children:o?"\uD83D\uDE48":"\uD83D\uDC41️"})]}),(0,s.jsx)("p",{className:"mt-2 text-xs text-gray-500",children:"Your API key is encrypted and sent securely to the enclave."})]}),p&&(0,s.jsx)("div",{className:"p-3 bg-red-900/50 border border-red-800 rounded-lg text-red-400 text-sm",children:p}),(0,s.jsx)("button",{onClick:A,disabled:u||!n.trim(),className:"w-full py-3 px-4 bg-primary text-black font-medium rounded-lg hover:bg-primary/90 disabled:bg-primary/50 disabled:cursor-not-allowed transition-colors",children:u?(0,s.jsxs)("span",{className:"flex items-center justify-center gap-2",children:[(0,s.jsx)("span",{className:"w-2 h-2 rounded-full bg-black animate-bounce",style:{animationDelay:"0ms"}}),(0,s.jsx)("span",{className:"w-2 h-2 rounded-full bg-black animate-bounce",style:{animationDelay:"150ms"}}),(0,s.jsx)("span",{className:"w-2 h-2 rounded-full bg-black animate-bounce",style:{animationDelay:"300ms"}})]}):"Set API Key"})]}):(0,s.jsx)("p",{className:"text-gray-400",children:"Connect to enclave first to set API key."})]})}function p(e){var t,a;let{isOpen:n,onClose:l,data:c}=e,[o,d]=(0,r.useState)("attestation"),[m,u]=(0,r.useState)(null),[x,p]=(0,r.useState)(!1),[h,y]=(0,r.useState)(null);(0,r.useEffect)(()=>{n&&(null==c?void 0:c.attestation)&&!m&&f()},[n,null==c?void 0:c.attestation]);let f=async()=>{if(null==c?void 0:c.attestation){p(!0),y(null);try{try{let e=JSON.parse(c.attestation),t=e.attestation_document||e,a=null;if(t.user_data){if("string"==typeof t.user_data)try{a=JSON.parse(t.user_data)}catch(e){}else"object"==typeof t.user_data&&(a=t.user_data)}let s={attestation_document:{module_id:t.module_id||"",digest:t.digest||"",timestamp:t.timestamp||0,pcrs:t.pcrs||{},certificate:t.has_certificate?"[present]":"",cabundle:t.has_cabundle?["[present]"]:[],public_key:t.public_key||"",user_data:a?JSON.stringify(a):"",nonce:t.nonce||""},module_id:t.module_id||"",digest:t.digest||"",timestamp:t.timestamp||0,pcrs:t.pcrs||{},certificate:t.has_certificate?"[present]":"",cabundle:t.has_cabundle?["[present]"]:[],public_key:t.public_key||"",user_data:a?JSON.stringify(a):"",nonce:t.nonce||""};u(s);return}catch(e){}let e=await (0,i.u4)(c.attestation);u(e)}catch(e){console.error("Failed to decode attestation:",e),y(e instanceof Error?e.message:"Failed to decode attestation")}finally{p(!1)}}};if(!n||!c)return null;let g=e=>{navigator.clipboard.writeText(e)},b=e=>{try{return JSON.stringify(JSON.parse(e),null,2)}catch(t){return e}},v=(null==m?void 0:m.user_data)?(0,i.tG)(m.user_data):null,j=c.ethAddr||(null==v?void 0:v.ethAddr)||"Unknown";return(0,s.jsxs)("div",{className:"fixed inset-0 z-50 flex items-center justify-center",children:[(0,s.jsx)("div",{className:"absolute inset-0 bg-black/70 backdrop-blur-sm",onClick:l}),(0,s.jsxs)("div",{className:"relative bg-[#0a0a0a] border border-gray-800 rounded-xl shadow-2xl w-full max-w-4xl max-h-[85vh] overflow-hidden mx-4",children:[(0,s.jsxs)("div",{className:"flex items-center justify-between p-4 border-b border-gray-800",children:[(0,s.jsxs)("div",{className:"flex items-center gap-2",children:[(0,s.jsx)("svg",{xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",strokeWidth:"1.5",stroke:"currentColor",className:"h-5 w-5 text-primary",children:(0,s.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M9 12.75 11.25 15 15 9.75m-3-7.036A11.959 11.959 0 0 1 3.598 6 11.99 11.99 0 0 0 3 9.749c0 5.592 3.824 10.29 9 11.623 5.176-1.332 9-6.03 9-11.622 0-1.31-.21-2.571-.598-3.751h-.152c-3.196 0-6.1-1.248-8.25-3.285Z"})}),(0,s.jsx)("h2",{className:"text-lg font-semibold text-white",children:"Verification Details"})]}),(0,s.jsx)("button",{onClick:l,className:"text-gray-400 hover:text-white transition-colors",children:(0,s.jsx)("svg",{xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",strokeWidth:"1.5",stroke:"currentColor",className:"h-5 w-5",children:(0,s.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M6 18 18 6M6 6l12 12"})})})]}),(0,s.jsx)("div",{className:"flex border-b border-gray-800",children:[{id:"attestation",label:"Attestation"},{id:"request",label:"Request"},{id:"response",label:"Response"}].map(e=>(0,s.jsx)("button",{onClick:()=>d(e.id),className:"flex-1 px-4 py-3 text-sm font-medium transition-colors ".concat(o===e.id?"text-primary border-b-2 border-primary bg-primary/5":"text-gray-400 hover:text-white"),children:e.label},e.id))}),(0,s.jsxs)("div",{className:"p-4 overflow-y-auto max-h-[calc(85vh-140px)]",children:["attestation"===o&&(0,s.jsx)("div",{className:"space-y-4",children:x?(0,s.jsxs)("div",{className:"flex items-center justify-center py-8",children:[(0,s.jsx)("div",{className:"w-6 h-6 border-2 border-primary border-t-transparent rounded-full animate-spin"}),(0,s.jsx)("span",{className:"ml-2 text-gray-400",children:"Decoding attestation..."})]}):h?(0,s.jsx)("div",{className:"p-4 bg-red-900/30 border border-red-800 rounded-lg text-red-400 text-sm",children:h}):m?(0,s.jsxs)(s.Fragment,{children:[(0,s.jsxs)("div",{className:"p-4 bg-primary/10 border border-primary/30 rounded-lg",children:[(0,s.jsxs)("div",{className:"flex items-center justify-between",children:[(0,s.jsx)("span",{className:"text-sm text-gray-400",children:"ETH Address"}),(0,s.jsx)("button",{onClick:()=>g(j),className:"text-xs text-gray-500 hover:text-white",children:"Copy"})]}),(0,s.jsx)("p",{className:"mt-1 font-mono text-primary text-sm break-all",children:j})]}),(0,s.jsxs)("div",{children:[(0,s.jsxs)("div",{className:"flex items-center justify-between mb-1",children:[(0,s.jsx)("label",{className:"text-sm font-medium text-gray-300",children:"Public Key"}),(0,s.jsx)("button",{onClick:()=>g(c.publicKey),className:"text-xs text-gray-500 hover:text-white",children:"Copy"})]}),(0,s.jsx)("p",{className:"p-2 bg-[#1a1a1a] rounded border border-gray-800 font-mono text-xs text-primary break-all max-h-20 overflow-y-auto",children:c.publicKey})]}),(0,s.jsxs)("div",{children:[(0,s.jsx)("div",{className:"flex items-center justify-between mb-2",children:(0,s.jsx)("label",{className:"text-sm font-medium text-gray-300",children:"PCR Values (Code Measurement)"})}),(0,s.jsx)("div",{className:"p-3 bg-[#1a1a1a] rounded border border-gray-800 space-y-1",children:m.pcrs&&Object.entries(m.pcrs).filter(e=>{let[t]=e;return["0","1","2","3"].includes(String(t))}).sort((e,t)=>{let[a]=e,[s]=t;return parseInt(a)-parseInt(s)}).map(e=>{let[t,a]=e;return(0,s.jsxs)("div",{className:"flex gap-2 text-xs",children:[(0,s.jsxs)("span",{className:"text-gray-500 w-12 flex-shrink-0",children:["PCR",t,":"]}),(0,s.jsx)("span",{className:"font-mono text-gray-300 break-all",children:a})]},t)})})]}),(0,s.jsx)("div",{className:"border border-gray-800 rounded-lg overflow-hidden",children:(0,s.jsxs)("details",{className:"group",children:[(0,s.jsxs)("summary",{className:"px-4 py-3 bg-[#1a1a1a] cursor-pointer flex items-center justify-between hover:bg-[#252525] transition-colors",children:[(0,s.jsx)("span",{className:"text-sm font-medium text-gray-300",children:"Full Attestation"}),(0,s.jsx)("svg",{xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",strokeWidth:"1.5",stroke:"currentColor",className:"h-4 w-4 text-gray-500 group-open:rotate-180 transition-transform",children:(0,s.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"m19.5 8.25-7.5 7.5-7.5-7.5"})})]}),(0,s.jsxs)("div",{className:"p-4 bg-[#0a0a0a] space-y-3",children:[(0,s.jsxs)("div",{children:[(0,s.jsx)("label",{className:"text-xs font-medium text-gray-400",children:"Module ID"}),(0,s.jsx)("p",{className:"mt-1 p-2 bg-[#1a1a1a] rounded border border-gray-800 font-mono text-xs text-white",children:m.module_id||"N/A"})]}),(0,s.jsxs)("div",{children:[(0,s.jsx)("label",{className:"text-xs font-medium text-gray-400",children:"Digest"}),(0,s.jsx)("p",{className:"mt-1 p-2 bg-[#1a1a1a] rounded border border-gray-800 font-mono text-xs text-white",children:m.digest||"N/A"})]}),(0,s.jsxs)("div",{children:[(0,s.jsx)("label",{className:"text-xs font-medium text-gray-400",children:"Timestamp"}),(0,s.jsx)("p",{className:"mt-1 p-2 bg-[#1a1a1a] rounded border border-gray-800 font-mono text-xs text-white",children:m.timestamp?"".concat(new Date(m.timestamp).toLocaleString()," (").concat(m.timestamp,")"):"N/A"})]}),(0,s.jsxs)("div",{children:[(0,s.jsx)("label",{className:"text-xs font-medium text-gray-400",children:"All PCR Values"}),(0,s.jsx)("div",{className:"mt-1 p-2 bg-[#1a1a1a] rounded border border-gray-800 space-y-1 max-h-40 overflow-y-auto",children:m.pcrs&&Object.keys(m.pcrs).length>0?Object.entries(m.pcrs).sort((e,t)=>{let[a]=e,[s]=t;return parseInt(a)-parseInt(s)}).map(e=>{let[t,a]=e;return(0,s.jsxs)("div",{className:"flex gap-2 text-xs",children:[(0,s.jsxs)("span",{className:"text-gray-500 w-12 flex-shrink-0",children:["PCR",t,":"]}),(0,s.jsx)("span",{className:"font-mono text-gray-300 break-all",children:a||"N/A"})]},t)}):(0,s.jsx)("span",{className:"text-gray-500 text-xs",children:"N/A"})})]}),(0,s.jsxs)("div",{children:[(0,s.jsx)("label",{className:"text-xs font-medium text-gray-400",children:"Public Key"}),(0,s.jsx)("p",{className:"mt-1 p-2 bg-[#1a1a1a] rounded border border-gray-800 font-mono text-xs text-primary break-all max-h-20 overflow-y-auto",children:m.public_key||"N/A"})]}),(0,s.jsxs)("div",{children:[(0,s.jsx)("label",{className:"text-xs font-medium text-gray-400",children:"Certificate"}),(0,s.jsx)("p",{className:"mt-1 p-2 bg-[#1a1a1a] rounded border border-gray-800 font-mono text-xs text-gray-400 break-all max-h-24 overflow-y-auto",children:m.certificate||"N/A"})]}),(0,s.jsxs)("div",{children:[(0,s.jsxs)("label",{className:"text-xs font-medium text-gray-400",children:["CA Bundle (",(null===(t=m.cabundle)||void 0===t?void 0:t.length)||0," certs)"]}),(0,s.jsx)("div",{className:"mt-1 p-2 bg-[#1a1a1a] rounded border border-gray-800 space-y-1 max-h-32 overflow-y-auto",children:m.cabundle&&m.cabundle.length>0?m.cabundle.map((e,t)=>(0,s.jsxs)("div",{className:"text-xs",children:[(0,s.jsxs)("span",{className:"text-gray-500",children:["Cert ",t+1,":"]}),(0,s.jsxs)("span",{className:"font-mono text-gray-400 break-all ml-2",children:[e.substring(0,60),"..."]})]},t)):(0,s.jsx)("span",{className:"text-gray-500 text-xs",children:"N/A"})})]}),(0,s.jsxs)("div",{children:[(0,s.jsx)("label",{className:"text-xs font-medium text-gray-400",children:"Nonce"}),(0,s.jsx)("p",{className:"mt-1 p-2 bg-[#1a1a1a] rounded border border-gray-800 font-mono text-xs text-gray-400 break-all",children:m.nonce||"N/A"})]}),(0,s.jsxs)("div",{children:[(0,s.jsx)("label",{className:"text-xs font-medium text-gray-400",children:"User Data"}),(0,s.jsx)("pre",{className:"mt-1 p-2 bg-[#1a1a1a] rounded border border-gray-800 font-mono text-xs text-gray-400 break-all whitespace-pre-wrap max-h-32 overflow-y-auto",children:m.user_data?(null==v?void 0:v.isJson)&&v.jsonData?JSON.stringify(v.jsonData,null,2):(null==v?void 0:v.ethAddr)||m.user_data:"N/A"})]})]})]})})]}):(0,s.jsx)("p",{className:"text-gray-500 text-center py-8",children:"No attestation data available"})}),"request"===o&&(0,s.jsxs)("div",{className:"space-y-4",children:[(0,s.jsxs)("div",{children:[(0,s.jsx)("div",{className:"flex items-center justify-between mb-2",children:(0,s.jsx)("label",{className:"text-sm font-medium text-gray-300",children:"Original Request (Plaintext)"})}),(0,s.jsx)("pre",{className:"p-3 bg-[#1a1a1a] rounded border border-gray-800 font-mono text-xs text-white overflow-auto max-h-32",children:b(c.decryptedRequest)})]}),(0,s.jsxs)("div",{children:[(0,s.jsxs)("div",{className:"flex items-center justify-between mb-2",children:[(0,s.jsx)("label",{className:"text-sm font-medium text-gray-300",children:"Encrypted Request (Sent to Enclave)"}),(0,s.jsx)("button",{onClick:()=>g(c.encryptedRequest),className:"text-xs text-gray-500 hover:text-white",children:"Copy"})]}),(0,s.jsx)("pre",{className:"p-3 bg-[#1a1a1a] rounded border border-gray-800 font-mono text-xs text-gray-400 overflow-auto max-h-40 break-all",children:b(c.encryptedRequest)})]})]}),"response"===o&&(0,s.jsxs)("div",{className:"space-y-6",children:[(0,s.jsxs)("div",{className:"border border-gray-800 rounded-lg overflow-hidden",children:[(0,s.jsx)("div",{className:"bg-[#1a1a1a] px-4 py-2 border-b border-gray-800",children:(0,s.jsxs)("h3",{className:"text-sm font-medium text-white flex items-center gap-2",children:[(0,s.jsx)("span",{className:"w-5 h-5 rounded-full bg-primary/20 text-primary text-xs flex items-center justify-center",children:"1"}),"Signature Verification"]})}),(0,s.jsxs)("div",{className:"p-4 space-y-3",children:[(0,s.jsxs)("div",{children:[(0,s.jsx)("label",{className:"text-xs font-medium text-gray-400",children:"Raw Response from Enclave"}),(0,s.jsx)("pre",{className:"mt-1 p-2 bg-[#0a0a0a] rounded font-mono text-xs text-gray-300 overflow-auto max-h-32",children:'{\n  "sig": "'.concat(null===(a=c.signature)||void 0===a?void 0:a.substring(0,32),'...",\n  "data": { ... encrypted_envelope }\n}')})]}),(0,s.jsxs)("div",{children:[(0,s.jsx)("label",{className:"text-xs font-medium text-gray-400",children:"Signature (EIP-191)"}),(0,s.jsx)("div",{className:"mt-1 p-2 bg-[#0a0a0a] rounded font-mono text-xs text-primary break-all max-h-20 overflow-y-auto",children:c.signature})]}),(0,s.jsxs)("div",{className:"p-3 bg-primary/10 border border-primary/30 rounded-lg flex items-start gap-2",children:[(0,s.jsx)("svg",{xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",strokeWidth:"1.5",stroke:"currentColor",className:"h-5 w-5 text-primary flex-shrink-0 mt-0.5",children:(0,s.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M9 12.75 11.25 15 15 9.75M21 12a9 9 0 1 1-18 0 9 9 0 0 1 18 0Z"})}),(0,s.jsxs)("div",{children:[(0,s.jsx)("p",{className:"text-sm font-medium text-primary",children:"Signature Verified"}),(0,s.jsxs)("p",{className:"text-xs text-gray-400 mt-0.5",children:["This signature was created by TEE wallet: ",(0,s.jsxs)("span",{className:"text-primary font-mono",children:[null==j?void 0:j.substring(0,10),"...",null==j?void 0:j.substring(j.length-8)]})]})]})]})]})]}),(0,s.jsxs)("div",{className:"border border-gray-800 rounded-lg overflow-hidden",children:[(0,s.jsx)("div",{className:"bg-[#1a1a1a] px-4 py-2 border-b border-gray-800",children:(0,s.jsxs)("h3",{className:"text-sm font-medium text-white flex items-center gap-2",children:[(0,s.jsx)("span",{className:"w-5 h-5 rounded-full bg-primary/20 text-primary text-xs flex items-center justify-center",children:"2"}),"Data Decryption"]})}),(0,s.jsxs)("div",{className:"p-4 space-y-3",children:[(0,s.jsxs)("div",{children:[(0,s.jsxs)("div",{className:"flex items-center justify-between",children:[(0,s.jsx)("label",{className:"text-xs font-medium text-gray-400",children:"Encrypted Data (from enclave)"}),(0,s.jsx)("button",{onClick:()=>g(c.encryptedResponse),className:"text-xs text-gray-500 hover:text-white",children:"Copy"})]}),(0,s.jsx)("pre",{className:"mt-1 p-2 bg-[#0a0a0a] rounded font-mono text-xs text-gray-400 overflow-auto max-h-24 break-all",children:b(c.encryptedResponse)})]}),(0,s.jsxs)("div",{className:"flex items-center justify-center py-2",children:[(0,s.jsx)("svg",{xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",strokeWidth:"1.5",stroke:"currentColor",className:"h-5 w-5 text-gray-600",children:(0,s.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M19.5 13.5 12 21m0 0-7.5-7.5M12 21V3"})}),(0,s.jsx)("span",{className:"ml-2 text-xs text-gray-600",children:"AES-256-GCM Decryption"})]}),(0,s.jsxs)("div",{children:[(0,s.jsx)("label",{className:"text-xs font-medium text-gray-400",children:"Decrypted Response"}),(0,s.jsx)("pre",{className:"mt-1 p-2 bg-[#0a0a0a] rounded font-mono text-xs text-white overflow-auto max-h-40",children:b(c.decryptedResponse)})]})]})]})]})]})]})]})}function h(e){let{isReady:t,selectedModel:a}=e,[n,i]=(0,r.useState)([]),[l,c]=(0,r.useState)(""),[o,d]=(0,r.useState)(!1),[u,x]=(0,r.useState)(null),[h,y]=(0,r.useState)(null),[f,g]=(0,r.useState)(!1),[b,v]=(0,r.useState)(null),j=(0,r.useRef)(null),w=()=>{var e;null===(e=j.current)||void 0===e||e.scrollIntoView({behavior:"smooth"})};(0,r.useEffect)(()=>{w()},[n]);let N=async e=>{if(e.preventDefault(),!l.trim()||!t||o)return;let s=l.trim();c(""),x(null),i(e=>[...e,{role:"user",content:s}]),d(!0);try{let e=await m.chat(s,a);i(t=>[...t,{role:"assistant",content:e.response,timestamp:e.timestamp,platform:e.platform,ai_model:e.ai_model,signature:e.signature,verificationData:{attestation:e.verificationData.attestation,publicKey:e.verificationData.publicKey,ethAddr:e.verificationData.ethAddr,encryptedRequest:e.verificationData.encryptedRequest,decryptedRequest:e.verificationData.decryptedRequest,rawResponse:e.verificationData.rawResponse,encryptedResponse:e.verificationData.encryptedResponse,decryptedResponse:e.verificationData.decryptedResponse,signature:e.signature}}])}catch(e){console.error("Chat error:",e),x(e instanceof Error?e.message:"Failed to send message")}finally{d(!1)}},k=e=>e?new Date(1e3*e).toLocaleString():"Unknown",A=e=>{v(e),g(!0)};return(0,s.jsxs)(s.Fragment,{children:[(0,s.jsxs)("div",{className:"flex flex-col h-full",children:[(0,s.jsxs)("div",{className:"flex-1 overflow-y-auto p-4 space-y-4",children:[0===n.length?(0,s.jsx)("div",{className:"flex items-center justify-center h-full",children:(0,s.jsxs)("div",{className:"text-center text-gray-500 max-w-md",children:[(0,s.jsx)("h3",{className:"text-xl font-semibold text-white mb-2",children:"Start a Conversation"}),(0,s.jsx)("p",{className:"text-sm",children:"Your messages are encrypted end-to-end. The enclave signs every response for verification."}),(0,s.jsxs)("p",{className:"text-sm mt-2 flex items-center justify-center flex-wrap gap-1",children:["Click the",(0,s.jsx)("svg",{xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",strokeWidth:"1.5",stroke:"currentColor",className:"h-4 w-4 text-primary inline mx-1",children:(0,s.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M15.75 5.25a3 3 0 0 1 3 3m3 0a6 6 0 0 1-7.029 5.912c-.563-.097-1.159.026-1.563.43L10.5 17.25H8.25v2.25H6v2.25H2.25v-2.818c0-.597.237-1.17.659-1.591l6.499-6.499c.404-.404.527-1 .43-1.563A6 6 0 1 1 21.75 8.25Z"})}),"to view signature; click the",(0,s.jsx)("svg",{xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",strokeWidth:"1.5",stroke:"currentColor",className:"h-4 w-4 text-primary inline mx-1",children:(0,s.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M9 12.75 11.25 15 15 9.75m-3-7.036A11.959 11.959 0 0 1 3.598 6 11.99 11.99 0 0 0 3 9.749c0 5.592 3.824 10.29 9 11.623 5.176-1.332 9-6.03 9-11.622 0-1.31-.21-2.571-.598-3.751h-.152c-3.196 0-6.1-1.248-8.25-3.285Z"})}),"for full details."]})]})}):n.map((e,t)=>(0,s.jsxs)("div",{className:"flex items-start gap-2 ".concat("user"===e.role?"justify-start":"justify-end"),children:["assistant"===e.role&&(0,s.jsx)("div",{className:"flex-shrink-0 w-8 h-8 rounded-full bg-primary/20 flex items-center justify-center order-2",children:(0,s.jsx)("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 24 24",fill:"currentColor",className:"w-5 h-5 text-primary",children:(0,s.jsx)("path",{d:"M12 2a1 1 0 0 1 1 1v1h2a3 3 0 0 1 3 3v1h1a1 1 0 0 1 1 1v6a1 1 0 0 1-1 1h-1v1a3 3 0 0 1-3 3H9a3 3 0 0 1-3-3v-1H5a1 1 0 0 1-1-1V9a1 1 0 0 1 1-1h1V7a3 3 0 0 1 3-3h2V3a1 1 0 0 1 1-1Zm-3 8a1.5 1.5 0 1 0 0 3 1.5 1.5 0 0 0 0-3Zm6 0a1.5 1.5 0 1 0 0 3 1.5 1.5 0 0 0 0-3Zm-5 5a1 1 0 0 0 0 2h4a1 1 0 1 0 0-2H10Z"})})}),(0,s.jsxs)("div",{className:"max-w-[80%] p-4 rounded-lg ".concat("user"===e.role?"bg-primary/20 text-white":"bg-[#1a1a1a] border border-gray-800 order-1"),children:[(0,s.jsxs)("div",{className:"inline",children:[(0,s.jsx)("p",{className:"whitespace-pre-wrap inline",children:e.content}),"assistant"===e.role&&e.signature&&(0,s.jsx)("button",{onClick:()=>y(h===t?null:t),className:"inline-flex align-middle ml-2 text-primary hover:opacity-80 transition-opacity",title:h===t?"Hide Details":"Show Details",children:(0,s.jsx)("svg",{xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",strokeWidth:"1.5",stroke:"currentColor",className:"h-4 w-4",children:(0,s.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M15.75 5.25a3 3 0 0 1 3 3m3 0a6 6 0 0 1-7.029 5.912c-.563-.097-1.159.026-1.563.43L10.5 17.25H8.25v2.25H6v2.25H2.25v-2.818c0-.597.237-1.17.659-1.591l6.499-6.499c.404-.404.527-1 .43-1.563A6 6 0 1 1 21.75 8.25Z"})})})]}),"assistant"===e.role&&h===t&&(0,s.jsxs)("div",{className:"mt-3 pt-3 border-t border-gray-700 space-y-2 text-xs text-gray-400",children:[(0,s.jsxs)("div",{className:"flex justify-between",children:[(0,s.jsx)("span",{children:"Platform:"}),(0,s.jsx)("span",{className:"text-white",children:e.platform})]}),(0,s.jsxs)("div",{className:"flex justify-between",children:[(0,s.jsx)("span",{children:"AI Model:"}),(0,s.jsx)("span",{className:"text-white",children:e.ai_model})]}),(0,s.jsxs)("div",{className:"flex justify-between",children:[(0,s.jsx)("span",{children:"Timestamp:"}),(0,s.jsx)("span",{className:"text-white",children:k(e.timestamp)})]}),e.signature&&(0,s.jsxs)("div",{children:[(0,s.jsxs)("div",{className:"flex justify-between items-center mb-1",children:[(0,s.jsx)("span",{children:"Verified Signature:"}),e.verificationData&&(0,s.jsx)("button",{onClick:()=>A(e.verificationData),className:"text-primary hover:opacity-80 transition-opacity",title:"Verification Details",children:(0,s.jsx)("svg",{xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",strokeWidth:"1.5",stroke:"currentColor",className:"h-4 w-4",children:(0,s.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M9 12.75 11.25 15 15 9.75m-3-7.036A11.959 11.959 0 0 1 3.598 6 11.99 11.99 0 0 0 3 9.749c0 5.592 3.824 10.29 9 11.623 5.176-1.332 9-6.03 9-11.622 0-1.31-.21-2.571-.598-3.751h-.152c-3.196 0-6.1-1.248-8.25-3.285Z"})})})]}),(0,s.jsx)("div",{className:"p-2 bg-[#0a0a0a] rounded font-mono text-primary break-all",children:e.signature})]})]})]})]},t)),o&&(0,s.jsx)("div",{className:"flex justify-end",children:(0,s.jsx)("div",{className:"max-w-[80%] p-4 rounded-lg bg-[#1a1a1a] border border-gray-800",children:(0,s.jsxs)("div",{className:"flex items-center gap-2",children:[(0,s.jsx)("span",{className:"w-2 h-2 rounded-full bg-primary animate-bounce",style:{animationDelay:"0ms"}}),(0,s.jsx)("span",{className:"w-2 h-2 rounded-full bg-primary animate-bounce",style:{animationDelay:"150ms"}}),(0,s.jsx)("span",{className:"w-2 h-2 rounded-full bg-primary animate-bounce",style:{animationDelay:"300ms"}})]})})}),(0,s.jsx)("div",{ref:j})]}),u&&(0,s.jsx)("div",{className:"mx-4 mb-2 p-3 bg-red-900/50 border border-red-800 rounded-lg text-red-400 text-sm",children:u}),(0,s.jsx)("form",{onSubmit:N,className:"p-4 border-t border-gray-800",children:(0,s.jsxs)("div",{className:"flex gap-2",children:[(0,s.jsx)("input",{type:"text",value:l,onChange:e=>c(e.target.value),placeholder:t?"Type your message...":"Connect and set API key first...",className:"flex-1 px-4 py-3 bg-[#0a0a0a] border border-gray-700 rounded-lg text-white placeholder-gray-500 focus:outline-none focus:ring-2 focus:ring-primary",disabled:!t||o}),(0,s.jsx)("button",{type:"submit",disabled:!t||o||!l.trim(),className:"px-6 py-3 bg-primary text-black font-medium rounded-lg hover:bg-primary/90 disabled:bg-primary/50 disabled:cursor-not-allowed transition-colors",children:"Send"})]})})]}),(0,s.jsx)(p,{isOpen:f,onClose:()=>g(!1),data:b})]})}let y=[{value:"gpt-5.1",label:"GPT-5.1"},{value:"gpt-5",label:"GPT-5"},{value:"gpt-5-mini",label:"GPT-5 Mini"},{value:"gpt-4.1",label:"GPT-4.1"},{value:"gpt-4.1-mini",label:"GPT-4.1 Mini"},{value:"gpt-4o",label:"GPT-4o"},{value:"gpt-4o-mini",label:"GPT-4o Mini"},{value:"gpt-4",label:"GPT-4"}];function f(){let[e,t]=(0,r.useState)(!1),[a,n]=(0,r.useState)(!1),[i,l]=(0,r.useState)(null),[c,o]=(0,r.useState)("gpt-5.1"),d=e&&a;return(0,s.jsxs)("div",{className:"min-h-screen bg-[#0a0a0a]",children:[(0,s.jsx)("header",{className:"border-b border-gray-800 px-6 py-4",children:(0,s.jsxs)("div",{className:"max-w-7xl mx-auto flex items-center justify-between",children:[(0,s.jsxs)("div",{className:"flex items-center gap-3",children:[(0,s.jsx)("img",{src:"/frontend/logo.png",alt:"Sparsity",className:"w-10 h-10"}),(0,s.jsxs)("div",{children:[(0,s.jsx)("h1",{className:"text-xl font-bold text-white",children:"Fully Secured Chat Bot"}),(0,s.jsx)("p",{className:"text-sm text-gray-400",children:"Powered by Sparsity Nova Platform"})]})]}),(0,s.jsxs)("div",{className:"flex items-center gap-4",children:[d&&(0,s.jsxs)("div",{className:"flex items-center gap-2",children:[(0,s.jsx)("svg",{xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",strokeWidth:"1.5",stroke:"currentColor",className:"w-4 h-4 text-gray-400",children:(0,s.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M9.813 15.904 9 18.75l-.813-2.846a4.5 4.5 0 0 0-3.09-3.09L2.25 12l2.846-.813a4.5 4.5 0 0 0 3.09-3.09L9 5.25l.813 2.846a4.5 4.5 0 0 0 3.09 3.09L15.75 12l-2.846.813a4.5 4.5 0 0 0-3.09 3.09ZM18.259 8.715 18 9.75l-.259-1.035a3.375 3.375 0 0 0-2.455-2.456L14.25 6l1.036-.259a3.375 3.375 0 0 0 2.455-2.456L18 2.25l.259 1.035a3.375 3.375 0 0 0 2.456 2.456L21.75 6l-1.035.259a3.375 3.375 0 0 0-2.456 2.456Z"})}),(0,s.jsx)("select",{value:c,onChange:e=>o(e.target.value),className:"bg-[#1a1a1a] border border-gray-700 rounded-lg px-3 py-1.5 text-sm text-white focus:outline-none focus:ring-2 focus:ring-primary cursor-pointer",children:y.map(e=>(0,s.jsx)("option",{value:e.value,children:e.label},e.value))})]}),e&&(0,s.jsxs)("div",{className:"flex items-center gap-2 text-sm",children:[(0,s.jsx)("div",{className:"w-2 h-2 rounded-full ".concat(a?"bg-green-500":"bg-yellow-500")}),(0,s.jsx)("span",{className:"text-gray-400",children:a?"Ready":"API Key Required"})]})]})]})}),(0,s.jsx)("main",{className:"max-w-7xl mx-auto p-6",children:d?(0,s.jsx)("div",{className:"h-[calc(100vh-10rem)] bg-[#111] rounded-lg border border-gray-800",children:(0,s.jsx)(h,{isReady:d,selectedModel:c})}):(0,s.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6 max-w-4xl mx-auto",children:[(0,s.jsx)(u,{onConnected:e=>{t(!0),l(e)}}),(0,s.jsx)(x,{isConnected:e,onApiKeySet:()=>{n(!0)}})]})}),(0,s.jsx)("footer",{className:"fixed bottom-0 left-0 right-0 border-t border-gray-800 bg-[#0a0a0a] px-6 py-3",children:(0,s.jsxs)("div",{className:"max-w-7xl mx-auto flex items-center justify-between text-sm text-gray-500",children:[(0,s.jsx)("span",{children:"End-to-end encrypted • Verifiable AI responses"}),i&&(0,s.jsxs)("span",{className:"font-mono text-xs text-gray-600",children:["Enclave: ",i.slice(0,10),"...",i.slice(-8)]})]})})]})}},6986:function(e,t,a){"use strict";function s(e){if(!e)return{isJson:!1};try{let t="string"==typeof e?JSON.parse(e):e;return{ethAddr:t.eth_addr||t.ethAddr,isJson:!0,jsonData:t}}catch(t){if("string"==typeof e&&e.startsWith("0x"))return{ethAddr:e,isJson:!1};return{isJson:!1}}}a.d(t,{Hd:function(){return m},nr:function(){return n},tG:function(){return s},u4:function(){return d}});let r=e=>Array.from(e instanceof Uint8Array?e:new Uint8Array(e)).map(e=>e.toString(16).padStart(2,"0")).join(""),n=e=>{e.startsWith("0x")&&(e=e.slice(2));let t=new Uint8Array(e.length/2);for(let a=0;a<e.length;a+=2)t[a/2]=parseInt(e.substr(a,2),16);return t};function i(e,t){var a;let s=(null===(a=btoa(new Uint8Array(t).reduce((e,t)=>e+String.fromCharCode(t),"")).match(/.{1,64}/g))||void 0===a?void 0:a.join("\n"))||"";return"-----BEGIN ".concat(e,"-----\n").concat(s,"\n-----END ").concat(e,"-----")}function l(e){for(let t=0;t<e.length;t++){let a=e.charCodeAt(t);if(!(a>=32&&a<=126||13===a||10===a||9===a))return!1}return!0}function c(e){if(e instanceof Uint8Array||e instanceof ArrayBuffer){let t=e instanceof Uint8Array?e:new Uint8Array(e);try{let e=new TextDecoder().decode(t);if(l(e))return e}catch(e){}return btoa(t.reduce((e,t)=>e+String.fromCharCode(t),""))}if(e instanceof Map){let t={};for(let[a,s]of Array.from(e.entries()))t[String(a)]=c(s);return t}if(Array.isArray(e))return e.map(e=>c(e));if(null!==e&&"object"==typeof e){let t={};for(let[a,s]of Object.entries(e))t[a]=c(s);return t}return e}function o(e){var t,a;console.log("[DEBUG] Raw attestation document:",e),console.log("[DEBUG] doc.public_key:",e.public_key),console.log("[DEBUG] doc.public_key type:",null===(a=e.public_key)||void 0===a?void 0:null===(t=a.constructor)||void 0===t?void 0:t.name);let s=e.public_key;e instanceof Map&&console.log("[DEBUG] doc is Map, public_key from get():",s=e.get("public_key"));let n=c(e),o=e instanceof Map?e.get("pcrs"):e.pcrs;if(o){let e={};if(o instanceof Map)for(let[t,a]of Array.from(o.entries()))e[String(t)]=a instanceof Uint8Array?r(a):c(a);else for(let[t,a]of Object.entries(o))e[t]=a instanceof Uint8Array?r(a):c(a);n.pcrs=e}if(s instanceof Uint8Array){let e=function(e){let t=new Uint8Array([48,118,48,16,6,7,42,134,72,206,61,2,1,6,5,43,129,4,0,34,3,98,0]);if(120===e.length&&48===e[0])return e;if(97!==e.length)return console.warn("[rawToDer] Unexpected key length ".concat(e.length,", returning as-is")),e;let a=new Uint8Array(t.length+e.length);return a.set(t,0),a.set(e,t.length),a}(s);n.public_key=r(e),console.log("[DEBUG] Converted public_key to DER hex:",n.public_key)}else s&&console.log("[DEBUG] publicKeyRaw is NOT Uint8Array, it is:",typeof s,s);let d=e instanceof Map?e.get("certificate"):e.certificate;d instanceof Uint8Array&&(n.certificate=i("CERTIFICATE",d));let m=e instanceof Map?e.get("cabundle"):e.cabundle;Array.isArray(m)&&(n.cabundle=m.map(e=>e instanceof Uint8Array?i("CERTIFICATE",e):c(e)));let u=e instanceof Map?e.get("user_data"):e.user_data;if(u instanceof Uint8Array)try{let e=new TextDecoder().decode(u);if(l(e))try{n.user_data=JSON.parse(e)}catch(t){n.user_data=e}else n.user_data=r(u)}catch(e){n.user_data=r(u)}return n}async function d(e){let t=await a.e(693).then(a.t.bind(a,4693,23)),s=atob(e),n=new Uint8Array(s.length);for(let e=0;e<s.length;e++)n[e]=s.charCodeAt(e);try{let e=t.decode(n);if(Array.isArray(e)&&e.length>=3){let a=e[0],s=a;if(a instanceof Uint8Array)try{s=t.decode(a)}catch(e){}let n=e[1],i=e[2],l=e.length>3?e[3]:null,d=t.decode(i),m=o(d);return{protected_header:c(s),unprotected_header:c(n),attestation_document:m,signature:l instanceof Uint8Array?r(l):c(l),module_id:m.module_id,digest:m.digest,timestamp:m.timestamp,pcrs:m.pcrs,public_key:m.public_key,user_data:"object"==typeof m.user_data?JSON.stringify(m.user_data):m.user_data,certificate:m.certificate,cabundle:m.cabundle,nonce:m.nonce}}{let t=o(e);return{attestation_document:t,module_id:t.module_id,digest:t.digest,timestamp:t.timestamp,pcrs:t.pcrs,public_key:t.public_key,user_data:"object"==typeof t.user_data?JSON.stringify(t.user_data):t.user_data,certificate:t.certificate,cabundle:t.cabundle,nonce:t.nonce}}}catch(e){throw console.error("Failed to parse CBOR attestation:",e),Error("Failed to parse attestation data")}}async function m(e,t){let a="".concat(e.replace(/\/$/,""),"/.well-known/attestation"),s={};t&&(s.nonce=btoa(t));let r=await fetch(a,{method:"POST",headers:{"Content-Type":"application/json",Accept:"application/cbor, application/octet-stream, application/json"},body:JSON.stringify(s)});if(!r.ok)throw Error("Failed to fetch attestation: ".concat(r.status));let n=r.headers.get("content-type")||"";if(n.includes("application/cbor")||n.includes("application/octet-stream")){let e=btoa(new Uint8Array(await r.arrayBuffer()).reduce((e,t)=>e+String.fromCharCode(t),""));return{...await d(e),raw_doc:e}}{let e=await r.json();if(e.attestation_document)return{...e,raw_doc:e.attestation_doc||JSON.stringify(e)};if(e.attestation_doc)return{...await d(e.attestation_doc),raw_doc:e.attestation_doc};throw Error("Unexpected attestation response format")}}}},function(e){e.O(0,[815,971,117,744],function(){return e(e.s=6710)}),_N_E=e.O()}]);