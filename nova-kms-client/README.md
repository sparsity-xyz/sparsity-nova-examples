# Nova KMS Client Example

This example demonstrates how to build a client application that securely interacts with the Nova KMS service using:
1.  **Service Discovery**: Resolves KMS node URLs via `KMSRegistry` and `NovaAppRegistry`.
2.  **PoP Authentication**: Authenticates requests using Proof-of-Possession (PoP) signatures generated by the specific TEE identity (via `Odyn`).

## Features

- **Automated Testing**: Periodically (every 10s) picks a random KMS node and runs a full cycle:
    - `/kms/derive` (Key Derivation)
    - `/kms/data` (Write & Read Encrypted Data)
- **Log Exposure**: Exposes interaction logs via `GET /logs` (no UI, just JSON).
- **Helios Integration**: Waits for the embedded Helios light client to sync before starting testing.

## Prerequisites

- Python 3.11+
- `pip`
- Access to a running `nova-kms` instance (simulation or production).

## Running Locally (Simulation)

1.  **Install Dependencies**:
    ```bash
    cd enclave
    pip install -r requirements.txt
    ```

2.  **Run Client**:
    You need to point the client to your KMS nodes. If running locally with `nova-kms` simulation on ports 8000/8001/8002:

    ```bash
    # Disable registries and manually point to local KMS nodes
    export KMS_NODES_FALLBACK="http://localhost:8000,http://localhost:8001,http://localhost:8002"
    export IN_ENCLAVE=false
    export SIMULATION_MODE=true
    
    python app.py
    ```

3.  **Check Logs**:
    ```bash
    curl http://localhost:8080/logs
    ```

## Running in Enclave (Production)

The client is designed to run as a Nova App.

1.  **Build**:
    ```bash
    enclaver build
    ```

2.  **Deploy**:
    Follow standard Nova deployment workflow. Ensure `KMS_REGISTRY_ADDRESS` and `NOVA_APP_REGISTRY_ADDRESS` are set in the deployment configuration.
